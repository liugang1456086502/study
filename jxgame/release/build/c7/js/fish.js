!function(t,i,e){e.un,e.uns;var n=e.static,s=e.class,a=e.getset,o=(e.__newvec,laya.display.Animation),r=game.core.manager.AudioManager,h=game.core.base.BaseModel,l=game.core.base.BaseModule,c=(laya.ui.Box,laya.utils.Browser),u=(laya.ui.Button,laya.filters.ColorFilter),_=(laya.ui.Dialog,laya.utils.Ease),f=(laya.events.Event,ui.fish.popup.FishAlertUI),d=ui.fish.scene.FishSceneUI,p=game.core.model.GlobalConfig,y=(game.core.enum.GlobalEnum,game.core.model.GlobalModel),b=game.core.enum.GlobalPopup,g=laya.utils.Handler,v=laya.ui.Image,I=laya.ui.Label,m=game.core.utils.Layer,k=(laya.net.Loader,game.core.enum.Module,laya.maths.Point),E=game.core.manager.PopupManager,x=game.core.utils.Redirect,F=ui.fish.scene.RoomViewUI,w=game.core.manager.SceneManager,S=ui.fish.popup.SettingUI,M=(game.core.vo.SettingVo,game.core.utils.Signal),A=laya.display.Sprite,T=(game.core.ui.Toast,laya.utils.Tween),B=e.UIConfig,C=laya.ui.View,L=(function(){function t(){}s(t,"game.module.fish.enum.FishPopup"),t.SETUP="SETUP"}(),function(){function t(){}s(t,"game.module.fish.enum.FishScene"),t.FISH="FISH",t.FISHHOME="FISHHOME",t.ROOMVIEW="ROOMVIEW",t.FISHVIEW="FISHVIEW"}(),function(){function t(){}s(t,"game.module.fish.enum.FishSignal"),t.START="START",t.ROOMLIST="ROOMLIST",t.NEWFISH="NEWFISH",t.ALLFISH="ALLFISH",t.NEWSCENE="NEWSCENE",t.CURSCENE="CURSCENE",t.NEWBULLET="NEWBULLET",t.NEWUSER="NEWUSER",t.ALLUSER="ALLUSER",t.NEWBATTERY="NEWBATTERY",t.LOCKFISH="LOCKFISH",t.QLOCKFISH="QLOCKFISH",t.FISHDEATH="FISHDEATH",t.USEPROP="USEPROP",t.SCENEPROP="SCENEPROP",t.PROPEND="PROPEND",t.USERPROP="USERPROP",t.OFFLINE="OFFLINE",t.ENTERFINISHED="ENTERFINISHED"}(),function(){function t(){}return s(t,"game.module.fish.FishConfig"),a(1,t,"batteryPipUrl",function(){return"res/fish/battery/bow2_%d.png"}),a(1,t,"GAME_WIDTH",function(){return 1920}),a(1,t,"enterTips",function(){return"Ani/aniScene.ani"}),a(1,t,"GAME_HEIGHT",function(){return 1080}),a(1,t,"fishNetUrl",function(){return"Ani/aniNet.ani"}),a(1,t,"batteryUrl",function(){return"res/fish/battery/bow1_%d.png"}),a(1,t,"bulletUrl",function(){return"Ani/aniBullet.ani"}),t.getRoomNameUrl=function(t){return"res/fish/room/num"+t+".png"},t.getRoomIconUrl=function(t){return"res/fish/room/icon"+t+".png"},t.getRoomStrokeColor=function(t){return["#1c5914","#5d308f","#865804"][t]||""},t.getSoundUrl=function(t,i){return void 0===i&&(i=!1),"res/fish/sound/"+t+p.getSoundExt(i)},n(t,["INIT_SKINS",function(){return this.INIT_SKINS=[{url:"res/fish/image.json",type:"atlas"},{url:"res/fish/res/res03.json",type:"atlas"},{url:"res/fish/res/res04.json",type:"atlas"},{url:"res/fish/res/res05.json",type:"atlas"},{url:"res/fish/res/res06.json",type:"atlas"},{url:"res/fish/res/res07.json",type:"atlas"},{url:"res/fish/res/res08.json",type:"atlas"},{url:"res/fish/res/res09.json",type:"atlas"},{url:"res/fish/res/res10.json",type:"atlas"},{url:"res/fish/res/res11.json",type:"atlas"},{url:"res/fish/res/res12.json",type:"atlas"},{url:"res/fish/res/res13.json",type:"atlas"},{url:"res/fish/battery.json",type:"atlas"},{url:"res/fish/textures.json",type:"atlas"},{url:"res/fish/bullet.json",type:"atlas"},{url:"res/fish/net.json",type:"atlas"},{url:"res/fish/room.json",type:"atlas"},{url:"res/fish/gold.json",type:"atlas"},{url:"res/fish/here.json",type:"atlas"},{url:"res/fish/lock.json",type:"atlas"},{url:"Ani/aniFish.ani",type:"json"},{url:"Ani/aniScene.ani",type:"json"},{url:"Ani/aniNet.ani",type:"json"},{url:"Ani/aniBullet.ani",type:"json"},{url:"Ani/aniGold.ani",type:"json"}]},"SCENE_CONFIG",function(){return this.SCENE_CONFIG={1:{id:1,res:"res/fish/image/bg%d.png"},2:{id:2,res:"res/fish/image/bg%d.png"},3:{id:3,res:"res/fish/image/bg%d.png"},4:{id:4,res:"res/fish/image/bg%d.png"},5:{id:5,res:"res/fish/image/bg%d.png"},6:{id:6,res:"res/fish/image/bg%d.png"}}},"FISH_CONFIG",function(){return this.FISH_CONFIG={1:{type:1,desc:"泥鳅",res:"Ani/aniFish.ani",aani:{key:"fish1_1",interval:128,loop:-1},dani:{key:"fish1_2",interval:128,loop:10},size:{width:350,height:350},bonding_box:[{r:12,a:0,b:0},{r:12,a:-13,b:0},{r:12,a:13,b:0}]},2:{type:2,desc:"蝴蝶鱼",res:"Ani/aniFish.ani",aani:{key:"fish2_1",interval:152,loop:-1},dani:{key:"fish2_2",interval:24,loop:10},size:{width:350,height:350},bonding_box:[{r:30,a:0,b:0}]},3:{type:3,desc:"小丑鱼",res:"Ani/aniFish.ani",aani:{key:"fish3_1",interval:64,loop:-1},dani:{key:"fish3_2",interval:100,loop:10},size:{width:350,height:350},bonding_box:[{r:40,a:-20,b:0},{r:40,a:20,b:0}]},4:{type:4,desc:"河豚",res:"Ani/aniFish.ani",aani:{key:"fish4_1",interval:256,loop:-1},dani:{key:"fish4_2",interval:23,loop:10},size:{width:350,height:350},bonding_box:[{r:23,a:-12,b:0},{r:23,a:12,b:0}]},5:{type:5,desc:"大眼鱼",res:"Ani/aniFish.ani",aani:{key:"fish5_1",interval:133,loop:-1},dani:{key:"fish5_2",interval:16,loop:10},size:{width:350,height:350},bonding_box:[{r:25,a:-14,b:0},{r:25,a:14,b:0}]},6:{type:6,desc:"花斑鱼",res:"Ani/aniFish.ani",aani:{key:"fish6_1",interval:152,loop:-1},dani:{key:"fish6_2",interval:16,loop:10},size:{width:350,height:350},bonding_box:[{r:20,a:35,b:0},{r:24,a:17,b:0},{r:28,a:-5,b:0}]},7:{type:7,desc:"海马",res:"Ani/aniFish.ani",aani:{key:"fish7_1",interval:152,loop:-1},dani:{key:"fish7_2",interval:16,loop:10},size:{width:350,height:350},bonding_box:[{r:20,a:15,b:18},{r:17,a:-12,b:-1},{r:17,a:-8,b:-23}]},8:{type:8,desc:"青蛙",res:"Ani/aniFish.ani",aani:{key:"fish8_1",interval:152,loop:-1},dani:{key:"fish8_2",interval:16,loop:10},size:{width:350,height:350},bonding_box:[{r:54,a:0,b:0}]},9:{type:9,desc:"乌龟",res:"Ani/aniFish.ani",aani:{key:"fish9_1",interval:64,loop:-1},dani:{key:"fish9_2",interval:30,loop:10},size:{width:350,height:350},bonding_box:[{r:67,a:0,b:0}]},10:{type:10,desc:"虾",res:"Ani/aniFish.ani",aani:{key:"fish10_1",interval:25,loop:-1},dani:{key:"fish10_2",interval:25,loop:10},size:{width:350,height:350},bonding_box:[{r:39,a:36,b:0},{r:16,a:-38,b:-14}]},11:{type:11,desc:"草鱼",res:"Ani/aniFish.ani",aani:{key:"fish11_1",interval:190,loop:-1},dani:{key:"fish11_2",interval:24,loop:10},size:{width:350,height:350},bonding_box:[{r:40,a:-66,b:-17},{r:40,a:-2,b:-5},{r:50,a:58,b:-1}]},12:{type:12,desc:"金龙",res:"Ani/aniFish.ani",aani:{key:"fish12_1",interval:112,loop:-1},dani:{key:"fish12_2",interval:210,loop:1},size:{width:350,height:350},bonding_box:[{r:39,a:194,b:10},{r:46,a:126,b:-5},{r:44,a:40,b:2},{r:42,a:-26,b:2},{r:28,a:-89,b:-3}]},13:{type:13,desc:"银龙",res:"Ani/aniFish.ani",aani:{key:"fish13_1",interval:112,loop:-1},dani:{key:"fish13_2",interval:210,loop:1},size:{width:350,height:350},bonding_box:[{r:39,a:194,b:10},{r:46,a:126,b:-5},{r:44,a:40,b:2},{r:42,a:-26,b:2},{r:28,a:-89,b:-3}]},14:{type:14,desc:"尖嘴鱼",res:"Ani/aniFish.ani",aani:{key:"fish14_1",interval:152,loop:-1},dani:{key:"fish14_2",interval:8,loop:10},size:{width:350,height:350},bonding_box:[{r:40,a:127,b:5},{r:55,a:22,b:0},{r:40,a:-78,b:-1}]},15:{type:15,desc:"蝙蝠鱼",res:"Ani/aniFish.ani",aani:{key:"fish15_1",interval:285,loop:-1},dani:{key:"fish15_2",interval:27,loop:10},size:{width:350,height:350},bonding_box:[{r:85,a:53,b:0}]},16:{type:16,desc:"小海豚",res:"Ani/aniFish.ani",aani:{key:"fish16_1",interval:152,loop:-1},dani:{key:"fish16_2",interval:30,loop:10},size:{width:350,height:350},bonding_box:[{r:73,a:80,b:0},{r:40,a:-39,b:0}]},17:{type:17,desc:"大白鲨",res:"Ani/aniFish.ani",aani:{key:"fish17_1",interval:152,loop:-1},dani:{key:"fish17_2",interval:19,loop:10},size:{width:350,height:350},bonding_box:[{r:25,a:175,b:0},{r:55,a:111,b:0},{r:67,a:34,b:0},{r:40,a:-56,b:0},{r:39,a:-120,b:0}]},18:{type:18,desc:"美人鱼",res:"Ani/aniFish.ani",aani:{key:"fish18_1",interval:300,loop:-1},dani:{key:"fish18_2",interval:80,loop:10},size:{width:350,height:350},bonding_box:[{r:57,a:28,b:0},{r:104,a:-122,b:20},{r:120,a:167,b:0}]},19:{type:19,desc:"金蟾",res:"Ani/aniFish.ani",aani:{key:"fish19_1",interval:340,loop:-1},dani:{key:"fish19_2",interval:24,loop:5},size:{width:350,height:350},bonding_box:[{r:125,a:0,b:0}]},20:{type:20,desc:"黄金鱼",res:"Ani/aniFish.ani",aani:{key:"fish20_1",interval:285,loop:-1},dani:{key:"fish20_2",interval:8,loop:10},size:{width:350,height:350},bonding_box:[{r:16,a:273,b:1},{r:36,a:224,b:0},{r:79,a:122,b:2},{r:66,a:46,b:2},{r:42,a:-73,b:3},{r:31,a:-128,b:3},{r:60,a:-207,b:8},{r:34,a:3,b:79},{r:30,a:3,b:-89}]},21:{type:21,desc:"全屏炸弹",res:"Ani/aniFish.ani",aani:{key:"fish21_1",interval:345,loop:-1},dani:{key:"fish21_2",interval:120,loop:1},size:{width:350,height:350},bonding_box:[{r:64,a:0,b:0}]},22:{type:22,desc:"绿草鱼",res:"Ani/aniFish.ani",aani:{key:"fish22_1",interval:48,loop:-1},dani:{key:"fish22_2",interval:48,loop:10},size:{width:350,height:350},bonding_box:[{r:15,a:-15,b:0},{r:15,a:0,b:0},{r:15,a:15,b:0}]}}},"BATTERY_CONFIG",function(){return this.BATTERY_CONFIG={1:{id:1,res:["res/fish/battery/paozuo.png","res/fish/battery/goldflat.png","res/fish/battery/dda.png","res/fish/battery/add.png","res/fish/battery/waitEnter.png"],music_eff:{1:"",2:""},fangle:90,bangle:180,bgangle:180,pos:{x:1493,y:81},linea:"res/fish/lock/lock_1.png",line:"res/fish/lock/lock_1_1.png"},2:{id:2,res:["res/fish/battery/paozuo.png","res/fish/battery/goldflat.png","res/fish/battery/dda.png","res/fish/battery/add.png","res/fish/battery/waitEnter.png"],music_eff:{1:"",2:""},fangle:90,bangle:180,bgangle:180,pos:{x:422,y:81},linea:"res/fish/lock/lock_2.png",line:"res/fish/lock/lock_2_1.png"},3:{id:3,res:["res/fish/battery/paozuo.png","res/fish/battery/goldflat.png","res/fish/battery/dda.png","res/fish/battery/add.png","res/fish/battery/waitEnter.png"],music_eff:{1:"",2:""},fangle:90,bangle:0,bgangle:0,pos:{x:1493,y:1003},linea:"res/fish/lock/lock_3.png",line:"res/fish/lock/lock_3_1.png"},4:{id:4,res:["res/fish/battery/paozuo.png","res/fish/battery/goldflat.png","res/fish/battery/dda.png","res/fish/battery/add.png","res/fish/battery/waitEnter.png"],music_eff:{1:"",2:""},fangle:90,bangle:0,bgangle:0,pos:{x:422,y:1003},linea:"res/fish/lock/lock_4.png",line:"res/fish/lock/lock_4_1.png"}}},"BULLET_CONFIG",function(){return this.BULLET_CONFIG={1:{bul:"aniBullet.ani",anet:"aniNet.ani"}}},"PROP_CONFIG",function(){return this.PROP_CONFIG={}}]),t}()),N=function(){function t(){}return s(t,"game.module.fish.popup.FishAlert"),t.show=function(i,n,s,a,o,r,h){void 0===s&&(s=!0),void 0===a&&(a=!0),void 0===o&&(o=!1),void 0===r&&(r=!0),void 0===h&&(h=0),t._ui||((t._ui=new f).close.on("click",null,t.close,["close"]),t._ui.enterBtn.on("click",null,t.close,["ok"]),t._ui.closeBtn.on("click",null,t.close,["close"]),t._leading=t._ui.text.leading,t._enterBtnX=t._ui.enterBtn.centerX),t._callback=n,t._isLayerClose=a,t._ui.closeBtn.visible=s,t._ui.enterBtn.centerX=s?t._enterBtnX:0,t._ui.text.leading=h||t._leading,t._ui.text.text=i;var l=e.stage.width,c=e.stage.height;o&&E.closeAll(),r&&(t._mask||((t._mask=new A).size(l,c),t._mask.graphics.drawRect(0,0,t._mask.width,t._mask.height,B.popupBgColor),t._mask.alpha=B.popupBgAlpha),m.alert.addChild(t._mask)),m.alert.addChild(t._ui),t._ui.x=Math.round((l-t._ui.width>>1)+t._ui.pivotX),t._ui.y=Math.round((c-t._ui.height>>1)+t._ui.pivotY),t._ui.scale(1,1),T.from(t._ui,{x:l/2,y:c/2,scaleX:0,scaleY:0},300,_.backOut)},t.close=function(i){(t._isLayerClose||"cancel"!=i)&&T.to(t._ui,{x:e.stage.width/2,y:e.stage.height/2,scaleX:0,scaleY:0},300,_.strongOut,g.create(null,function(){t._callback&&t._callback.runWith("ok"==i),t._mask&&t._mask.removeSelf(),t._ui.removeSelf()}))},t._ui=null,t._mask=null,t._callback=null,t._isLayerClose=!1,t._leading=NaN,t._enterBtnX=0,t}(),H=function(){function t(){}return s(t,"game.module.fish.utils.FishSound"),a(1,t,"initSounds",function(){return[]}),t.init=function(){r.start()},t.getUrl=function(t,i){return void 0===i&&(i=!1),L.getSoundUrl(t,i)},t}(),D=function(){function t(t){if(this._panel=null,this._object=[],this._batPos=[],!t)throw new console.log("Singleton Error")}var i;s(t,"game.module.fish.vo.BatteryManager");var e=t.prototype;return e.destroy=function(){t._instance=null},e.init=function(t){if(this._panel=t,this._panel){console.log("BatteryManager init success");for(var i in L.BATTERY_CONFIG){var e=L.BATTERY_CONFIG[i];if(e){var n=new W(e);this._panel.addChild(n),this._object.push(n)}}}else console.log("BatteryManager init failed")},e.createBattery=function(t){var i=this._object[parseInt(t.chairid)];i&&(i.come(),i.self=t.isSelf,i.name=t.name,i.score=t.score,i.playerId=t.id,i.self&&i.runTips())},e.newBattery=function(t,i){var e=this._object[i];e&&(e.multip=t.no,e.multipLable=t.boost,e.bore=t.bore,e.speed=t.speed,e.element=t.element,e.chairdID=i)},e.newRotation=function(t){for(var i=0;i<this._object.length;i++){var e=this._object[i];e&&(t<=1?e.newRotationBg(180):e.newRotationBg(0),t<=1?i>1?e.newRotationMul(180):e.newRotationMul(0):i>1?e.newRotationMul(0):e.newRotationMul(180),t<=1?3==i&&e.newRotationPosX(125):0==i&&e.newRotationPosX(-125))}},e.autoFire=function(t){for(var i=0;i<this._object.length;i++){var e=this._object[i];if(e&&e.self)return void(e.autoFire=t)}},e.autoLock=function(t){for(var i=0;i<this._object.length;i++){var e=this._object[i];if(e&&e.self)return e.autoLock=t,void(t||e.setQlockFish())}},e.lockFish=function(t,i){void 0===i&&(i="");var e=this._object[t];e&&(e.lockFish=i,e.autoLock=""!=i)},e.runTips=function(){for(var t=0;t<this._object.length;t++){var i=this._object[t];if(i&&i.self)return void i.runTips()}},e.reqbatteryFire=function(t){for(var i=0;i<this._object.length;i++){var e=this._object[i];if(e&&e.self)return void e.reqfire(t)}},e.batteryFire=function(t){var i=this._object[parseInt(t.chairID)];i&&(i.fireAngle(t),i.score=t.score)},e.getbattery=function(t){for(var i=0;i<this._object.length;i++){var e=this._object[i];if(e&&e.playerId==t)return e}return null},e.destroyAllBattery=function(){for(var t=0;t<this._object.length;t++){var i=this._object[t];i&&i.reset()}},e.destroybattery=function(t){for(var i=0;i<this._object.length;i++){var e=this._object[i];e&&e.playerId==t&&e.reset()}},e.update=function(){for(var t=0;t<this._object.length;t++){var i=this._object[t];i&&i._batteryNode.visible&&i.update()}},a(0,e,"lockList",null,function(t){for(var i=0;i<this._object.length;i++){var e=this._object[i];e&&(e.lockList=t)}}),a(1,t,"Instance",function(){return t._instance||(t._instance=new t(new i)),t._instance}),t._instance=null,t.__init$=function(){i=function(){function t(){}return s(t,""),t}()},t}(),R=function(){function t(t){if(this._panel=null,this._object=[],this._objectBBx=[],!t)throw new console.log("Singleton Error")}var i;s(t,"game.module.fish.vo.BulletManager");var e=t.prototype;return e.destroy=function(){t._instance=null},e.init=function(t){this._panel=t,this._panel?console.log("BulletManager init success"):console.log("BulletManager init failed")},e.send=function(t){var i=new X(t);this._panel.addChild(i),this._object[t.bulletId]=i,this._objectBBx[t.bulletId]=i.BBX},e.shotSomething=function(t){var i=this._object[t];i&&(i.shotSomething(),this._object[t]=null,this._objectBBx[t]=null)},e.update=function(){var t=0;for(var i=0 in this._object){var e=this._object[i];e&&(t++,e.update(),this._objectBBx[i]=e.BBX)}return t},e.clearBullets=function(){for(var t=0 in this._object){var i=this._object[t];i&&(i.removeSelf(),this._object[t]=null,this._objectBBx[t]=null)}this._object=[],this._objectBBx=[]},a(0,e,"bulletes",function(){return this._object}),a(1,t,"Instance",function(){return t._instance||(t._instance=new t(new i)),t._instance}),t._instance=null,t.__init$=function(){i=function(){function t(){}return s(t,""),t}()},t}(),G=function(){function t(t){if(!t)throw new console.log("Singleton Error")}var i;s(t,"game.module.fish.vo.CollideManager");var e=t.prototype;return e.destroy=function(){t._instance=null},e.update=function(){var t=0,i=[],e=R.Instance.bulletes;for(var n in e){var s=e[n];if(s){var a=s.BBX,o=D.Instance.getbattery(s.playerID);if(o&&""!=o.lockFish&&""!=s.lockFish){var r=j.Instance.getfisheById(o.lockFish);if(r&&o.lockFish==s.lockFish)r.isCatched(a)&&i.push({bulletID:s.bulletID,fishID:r.fishID,playerID:s.playerID});else{var h=j.Instance.catchFishByBBX(a);t+=h.count,h.fish&&i.push({bulletID:s.bulletID,fishID:h.fish.fishID,playerID:s.playerID})}}else{var l=j.Instance.catchFishByBBX(a);t+=l.count,l.fish&&i.push({bulletID:s.bulletID,fishID:l.fish.fishID,playerID:s.playerID})}}}for(var c=0 in i){var u=i[c];u&&U.instance.getUserInfo(u.playerID)&&(U.instance.sendHitFish(u.bulletID,u.fishID,u.playerID),R.Instance.shotSomething(u.bulletID))}return t},a(1,t,"Instance",function(){return t._instance||(t._instance=new t(new i)),t._instance}),t._instance=null,t.__init$=function(){i=function(){function t(){}return s(t,""),t}()},t}(),P=function(){function t(t){if(this._coolInfo={},this._coolItems={},!t)throw new console.log("Singleton Error")}var i;s(t,"game.module.fish.vo.CoolingManager");var e=t.prototype;return e.destroy=function(){t._instance=null},e.init=function(t){this._coolItems=t},e.addCooling=function(t,i){this._coolInfo[t]=i},e.updateTime=function(){var t=[];for(var i in this._coolInfo){var e=this._coolInfo[i];e&&e>0?this._coolInfo[i]=e-1e3:t.push(i);var n=this._coolItems[i];n&&(n.mouseEnabled=!e||!(e>0));var s=n.getChildByName("propIceTime");s&&(s.text=e&&e>0?e/1e3+"":"")}for(var a in t){var o=t[a];this._coolInfo[o]=null,delete this._coolInfo[o]}},a(1,t,"Instance",function(){return t._instance||(t._instance=new t(new i)),t._instance}),t._instance=null,t.__init$=function(){i=function(){function t(){}return s(t,""),t}()},t}(),j=function(){function t(t){if(this._bbx=[],this._index=[],this._object=[],this._objectBBX=[],this._panel=null,this._switch=0,!t)throw new console.log("Singleton Error")}var i;s(t,"game.module.fish.vo.FishManager");var e=t.prototype;return e.destroy=function(){t._instance=null},e.init=function(t){this._panel=t,this._panel?console.log("FishManager init success"):console.log("FishManager init failed")},e.createFish=function(t){var i=this._object[t.id];i||(i=new V(t),this._panel.addChild(i),this._object[t.id]=i,this._objectBBX[t.id]=i.BBX)},e.catchFishByBBX=function(t){var i={fish:null,count:0};for(var e=0 in this._objectBBX){var n=this._objectBBX[e];if(n)for(var s=0 in t){var a=t[s];if(a)for(var o=0 in n){var r=n[o];if(r){i.count++;var h=Math.floor(Math.sqrt(Math.pow(r.a-a.a,2)+Math.pow(r.b-a.b,2)));if(a.r+r.r>h)return this._object[e].beenShot(),i.fish=this._object[e],i}}}}return i},e.catchFishByPos=function(t){for(var i=0 in this._objectBBX){var e=this._objectBBX[i];if(e)for(var n=0 in e){var s=e[n];if(s){var a=Math.floor(Math.sqrt(Math.pow(s.a-t.x,2)+Math.pow(s.b-t.y,2)));if(s.r>a)return this._object[i]}}}return null},e.removeFish=function(t,i,e){var n=L.BATTERY_CONFIG[t+1];if(n){var s=this._object[i];s&&(s.fishScore=e,s.fishScoreAniPos=n.pos,s.death(),this._object[i]=null,this._objectBBX[i]=null)}},e.getfisheById=function(t){return this._object[t]},e.update=function(){var t=0,i=[];for(var e=0 in this._object){var n=this._object[e];n&&(t++,n._life?(n.update(),n.fishPause=U.instance.pauseFishes,this._objectBBX[e]=n.BBX,i.push(n)):(n.removeSelf(),this._object[e]=null,this._objectBBX[e]=null))}return D.Instance.lockList=i,t},e.clearFishes=function(){for(var t=0 in this._object){var i=this._object[t];i&&(i.removeSelf(),this._object[t]=null,this._objectBBX[t]=null)}this._object=[],this._objectBBX=[]},a(0,e,"fishes",function(){return this._object}),a(1,t,"Instance",function(){return t._instance||(t._instance=new t(new i)),t._instance}),t._instance=null,t.__init$=function(){i=function(){function t(){}return s(t,""),t}()},t}(),O=function(){function t(t){if(this._propInfo=[],this.ICE="by01",this.WIN="by02",this.ELE="by03",!t)throw new console.log("Singleton Error")}var i;s(t,"game.module.fish.vo.PropManager");var e=t.prototype;return e.destroy=function(){t._instance=null},e.init=function(){},e.startProp=function(t,i){switch(this._propInfo[t]=i,t){case this.ICE:U.instance.pauseFishes=!0;break;case this.WIN:case this.ELE:}},e.endProp=function(t,i){switch(this._propInfo[t]=i,t){case this.ICE:U.instance.pauseFishes=!1;break;case this.WIN:case this.ELE:}},e.updateTime=function(){var t=[];for(var i in this._propInfo){var e=this._propInfo[i];console.log(i+":道具生效中"+e),e&&e>0?this._propInfo[i]=e-1e3:t.push(i)}for(var n in t){var s=t[n];this._propInfo[s]=null,delete this._propInfo[s]}},a(1,t,"Instance",function(){return t._instance||(t._instance=new t(new i)),t._instance}),t._instance=null,t.__init$=function(){i=function(){function t(){}return s(t,""),t}()},t}(),U=function(t){function i(){this._roomId=0,this._enterfishes=[],this._players=[],this._sceneid=0,this._autoLock=!1,this._autoFire=!1,this._pauseFishes=!1,this._playerCooling=[],this._sceneProp=null,this._sceneRotation=!1,this._gameVisible=!0,i.__super.call(this)}s(i,"game.module.fish.FishModel",t);var e=i.prototype;return e.init=function(i){t.prototype.init.call(this,i),this.event("START")},e.onMessage=function(t){switch(t.op){case"newFish":this.event("NEWFISH",t);break;case"newScene":this.event("NEWSCENE",t);break;case"newBullet":this.event("NEWBULLET",t);break;case"inTable":this.userEnder(t.seat),this.event("NEWUSER");break;case"newBulletType":this.event("NEWBATTERY",t);break;case"removeBullet":break;case"lock":this.event("LOCKFISH",t);break;case"unlock":this.event("QLOCKFISH",t);break;case"killFish":"bulletHit"==t.deadType&&this.event("FISHDEATH",t);break;case"spItemUsed":this.event("USEPROP",t);break;case"quit":case"offline":this.event("OFFLINE",t);break;case"unFreeze":this.event("PROPEND",t);break;default:console.error("----fish message",t)}},e.enter=function(){var t=this;0!=this._roomId?this.send("fish.enter",{roomId:this._roomId},function(i,e){0==e&&t.getInfo(),(0!=e||i.state)&&N.show("\n"+i.errMsg,g.create(this,function(t){b.openShop(!0),game.module.fish.FishModel.instance.event("ROOMVIEW")}))}):game.module.fish.FishModel.instance.event("ROOMVIEW")},e.getRoomInfo=function(){var t=this;this.send("fish.roominfo",{},function(i,e){t.event("ROOMLIST",i)})},e.getInfo=function(){var t=this;this.send("fish.tableinfo",{},function(i){game.module.fish.FishModel.instance.event("FISHVIEW");var e=i.data;t._enterfishes=e.allFish,t.event("ALLFISH"),t._players=e.allPlayer,t.event("ALLUSER"),t._sceneid=e.curScen?e.curScene%3+1:1,t.event("CURSCENE"),t._sceneProp=e.currItem?e.currItem:null,t.event("SCENEPROP");for(var n=0;n<e.myCd.length;n++){var s=e.myCd[n];s&&s.leftTime>0&&t._playerCooling.push({itemId:s.id,leftTime:1e3*Math.ceil(s.leftTime/1e3)})}t.event("ENTERFINISHED")})},e.userEnder=function(t){for(var i=0;i<this._players.length;i++){var e=this._players[i];t.index==e.index&&(this._players[i]=t)}},e.getSelfInfo=function(){for(var t=0;t<this._players.length;t++){var i=this.players[t];if(i.isSat&&y.instance.self.userId==i.playerId)return i}return null},e.getUserInfo=function(t){for(var i=0;i<this._players.length;i++){var e=this.players[i];if(e.isSat&&t==e.playerId)return e}return null},e.getUserInfoByChairId=function(t){for(var i=0;i<this._players.length;i++){var e=this.players[i];if(e.isSat&&t==e.index)return e}return null},e.sendBullet=function(t){this.send("fish.shot",{angle:t},function(t,i){})},e.sendChangeBat=function(t){var i=this;this.send("fish.changebullet",{key:t},function(t,e){for(var n=0;n<i._players.length;n++){var s=i._players[n];if(t.data.playerId==s.playerId)return void(i._players[n].bulletType=t.currBulletType)}})},e.sendHitFish=function(t,i,e){this.send("fish.hitfish",{bulletId:t,fishId:i,playerId:e},function(t,i){})},e.sendAutoLock=function(t){this.send("fish.lock",{fishId:t},function(t,i){})},e.sendQAutoLock=function(){this.send("fish.unlock",{},function(t,i){})},e.sendProp=function(t){this.send("fish.spitem",{itemType:t},function(t){})},e.exit=function(){this.send("fish.quit",{},function(t){t.code,game.module.fish.FishModel.instance.event("ROOMVIEW")})},e.getAngleByTwoPoint=function(t,i){var e=180/Math.PI*Math.atan((t.y-i.y)/(t.x-i.x));return t.x>i.x&&t.y>i.y||(t.x<i.x&&t.y>i.y?e=180+e:t.x<i.x&&t.y<i.y?e=180+e:t.x>i.x&&t.y<i.y&&(e=360+e)),e},e.destroy=function(){t.prototype.destroy.call(this),i._instance=null},a(0,e,"pauseFishes",function(){return this._pauseFishes},function(t){this._pauseFishes=t}),a(0,e,"enterfishes",function(){return this._enterfishes}),a(0,e,"autoLock",function(){return this._autoLock},function(t){this._autoLock=t}),a(0,e,"players",function(){return this._players}),a(0,e,"Cooling",function(){return this._playerCooling}),a(0,e,"sceneid",function(){return this._sceneid}),a(0,e,"sceneProp",function(){return this._sceneProp}),a(0,e,"autoFire",function(){return this._autoFire},function(t){this._autoFire=t}),a(0,e,"sceneRotation",function(){return this._sceneRotation},function(t){this._sceneRotation=t}),a(0,e,"roomId",function(){return this._roomId},function(t){this._roomId=t}),a(1,i,"instance",function(){return i._instance||(i._instance=new i),i._instance},game.core.base.BaseModel._$SET_instance),i._instance=null,i}(h),W=function(t){function i(t){this._batteryNode=null,this._batteryBg=null,this._batteryInfo=null,this._wateEnter=null,this._userNick=null,this._userScore=null,this._userMul=null,this._add=null,this._cut=null,this._battery=null,this._batteryPip=null,this._self=!1,this._multip=0,this._element=0,this._bore=0,this._config=null,this._fireAngle=0,this._fireSpeed=0,this._frameCount=0,this._autoLock=!1,this._autoFire=!1,this._fire=!0,this._lockItem=[],this._lock_fish_lst=[],this._lockFish_ID="",this._chaird_ID=0,this._playerID="",i.__super.call(this),this._config=t,this.initData(),this.initView()}s(i,"game.module.fish.vo.Battery",A);var e=i.prototype;return e.initData=function(){this._self=!1,this._bore=1,this._multip=1,this._element=1,this._fireSpeed=0,this._playerID=this._config.id,this._fireAngle=this._config.fangle},e.initView=function(){this.x=this._config.pos.x,this.y=this._config.pos.y,this._batteryNode=new A,this.addChild(this._batteryNode),this._batteryBg=new v(this._config.res[0]),this._batteryBg.anchorX=.5,this._batteryBg.anchorY=.5,this._batteryBg.rotation=this._config.bgangle,this._batteryNode.addChild(this._batteryBg),this._batteryInfo=new A,this._batteryNode.addChild(this._batteryInfo);var t=new v(this._config.res[1]);t.pos(-345,-20),this._batteryInfo.addChild(t),this._userScore=new I("99999"),this._userScore.anchorX=0,this._userScore.anchorY=.5,this._userScore.font="Arial",this._userScore.fontSize=20,this._userScore.color="#ffffff",this._userScore.align="left",this._userScore.pos(-300,0),this._batteryInfo.addChild(this._userScore),this._userNick=new I("ABCDEF"),this._userNick.anchorX=0,this._userNick.anchorY=.5,this._userNick.font="Arial",this._userNick.fontSize=20,this._userNick.color="#ffffff",this._userNick.align="left",this._userNick.pos(180,0),this._batteryInfo.addChild(this._userNick),this._add=new v(this._config.res[3]),this._add.pos(70,-35),this._batteryInfo.addChild(this._add),this._add.on("click",this,this.addCallback),this._cut=new v(this._config.res[2]),this._cut.pos(-140,-35),this._batteryInfo.addChild(this._cut),this._cut.on("click",this,this.cutCallback),this._battery=new v(L.batteryUrl.replace(/%d/,this._bore)),this._battery.anchorX=.5,this._battery.anchorY=.5,this._battery.rotation=this._config.bangle,this._batteryNode.addChild(this._battery),this._batteryPip=new v(L.batteryPipUrl.replace(/%d/,this._bore)),this._batteryPip.pos(66,25),this._batteryPip.anchorX=.5,this._batteryPip.anchorY=1,this._battery.addChild(this._batteryPip),this._userMul=new I("倍数"),this._userMul.anchorX=.5,this._userMul.anchorY=.5,this._userMul.font="Arial",this._userMul.fontSize=16,this._userMul.color="#ffffff",this._userMul.align="center",this._userMul.pos(67,73),this._battery.addChild(this._userMul),this._wateEnter=new v(this._config.res[4]),this._wateEnter.anchorX=.5,this._wateEnter.anchorY=.5,this._wateEnter.visible=!1,this.addChild(this._wateEnter);for(var i=1;i<20;i++){var e=new v(this._config.line);e.anchorX=.5,e.anchorY=.5,e.y=-100*i,e.x=66,e.visible=!1,this._battery.addChild(e),this._lockItem.push(e)}},e.cutCallback=function(){this._multip=this._multip-1,this._multip<=0&&(this._multip=9),U.instance.sendChangeBat(this._multip)},e.addCallback=function(){this._multip=this._multip+1,this._multip>9&&(this._multip=1),U.instance.sendChangeBat(this._multip)},e.runTips=function(){},e.reqfire=function(t){var i=new k(this._battery.x,this._battery.y);this.localToGlobal(i),U.instance.sceneRotation&&(i.x=L.GAME_WIDTH-i.x,i.y=L.GAME_HEIGHT-i.y);var e=U.instance.getAngleByTwoPoint(t,{x:i.x,y:i.y});U.instance.sceneRotation&&t.y<i.y&&(e-=180),this._fireAngle=e,this._battery.rotation=e+this._config.fangle,this._self&&this._fire&&(U.instance.sendBullet(Math.floor(this._fireAngle)),this._fire=!1)},e.fireAngle=function(t){var i=this;this._self||(this._battery.rotation=t.angle+this._config.fangle);var e=new k(this._battery.x,this._battery.y);this.localToGlobal(e),U.instance.sceneRotation&&(e.x=L.GAME_WIDTH-e.x,e.y=L.GAME_HEIGHT-e.y),R.Instance.send({element:this._element,bore:this._bore,spos:{x:e.x,y:e.y},angle:t.angle,chairID:t.chairID,bulletId:t.bulletId,lockfish:this._lockFish_ID,playerId:this._playerID}),T.to(this._batteryPip,{scaleX:1.15,scaleY:.8},.2),this.frameOnce(2,this,function(){T.to(i._batteryPip,{scaleX:1,scaleY:1},.4)})},e.setQlockFish=function(){var t=j.Instance.getfisheById(this._lockFish_ID);t&&(t.shotflag.visible=!1),this.setlockLineLengh(0),this._lockFish_ID=""},e.setlockLineLengh=function(t){for(var i=t/88,e=0;e<20;e++){var n=this._lockItem[e];n&&(n.visible=e<i-4,i<=0&&(n.visible=!1))}},e.update=function(){if(this._frameCount++,this._autoFire&&(this.reqSend(),this._fire=!1),this._autoLock){this._fire=!1;var t=j.Instance.getfisheById(this._lockFish_ID);if(t){var i={x:t.lockPos.x,y:t.lockPos.y};if(i.x<L.GAME_WIDTH&&i.x>0&&i.y<L.GAME_HEIGHT&&i.y>0){var e=new k(this._battery.x,this._battery.y);this.localToGlobal(e),U.instance.sceneRotation&&(e.x=L.GAME_WIDTH-e.x,e.y=L.GAME_HEIGHT-e.y);var n=U.instance.getAngleByTwoPoint(i,e);this._fireAngle=n,this._battery.rotation=n+this._config.fangle;var s=Math.sqrt(Math.pow(e.x-t.lockPos.x,2)+Math.pow(e.y-t.lockPos.y,2));this.setlockLineLengh(s),t.shotflag.visible=!0,t.shotflag.skin=this._config.linea,this._self&&this.reqSend()}else t.shotflag.visible=!1,this.setlockLineLengh(0),this._lockFish_ID="",this.resetLock()}else this.setlockLineLengh(0),this._lockFish_ID="",this.resetLock()}else this.setlockLineLengh(0),this._lockFish_ID="";this._autoFire||this._autoLock||this._frameCount>=this._fireSpeed&&(this._frameCount=0,this._fire=!0)},e.resetLock=function(){for(var t=0 in this._lock_fish_lst){var i=this._lock_fish_lst[t];if(i&&i.x<=L.GAME_WIDTH&&i.x>=0&&i.y>=0&&i.y<=L.GAME_HEIGHT)return void(this._self&&(U.instance.sendAutoLock(i.fishID),this._lockFish_ID=i.fishID))}},e.reqSend=function(){this._frameCount>=this._fireSpeed&&(this._frameCount=0,U.instance.sendBullet(Math.floor(this._fireAngle)))},e.come=function(){this._batteryNode.visible=!0,this._wateEnter.visible=!1},e.reset=function(){this._userNick&&(this._userNick.text=""),this._userScore&&(this._userScore.text=""),this._userMul&&(this._userMul.text=""),this._battery.rotation=this._config.bangle,this._fireAngle=this._config.fangle,this._wateEnter.visible=!0,this._batteryNode.visible=!1;var t=j.Instance.getfisheById(this._lockFish_ID);t&&(t.shotflag.visible=!1),this.setlockLineLengh(0),this._lockFish_ID="",this._autoLock=!1,this._autoFire=!1,this._fire=!0,this.x=this._config.pos.x,this.y=this._config.pos.y},e.newRotationBg=function(t){this._batteryBg&&(this._batteryBg.rotation=t),this._batteryInfo&&(this._batteryInfo.rotation=t),this._wateEnter&&(this._wateEnter.rotation=t)},e.newRotationMul=function(t){this._userMul&&(this._userMul.rotation=t)},e.newRotationPosX=function(t){this.x=this._config.pos.x+t},a(0,e,"multip",null,function(t){this._multip=t>0?t:this._multip}),a(0,e,"name",null,function(t){this._userNick&&(this._userNick.text=t+"")}),a(0,e,"autoFire",function(){return this._autoFire},function(t){this._autoFire=t}),a(0,e,"multipLable",null,function(t){this._userMul&&(this._userMul.text=t+"")}),a(0,e,"element",null,function(t){this._element=t}),a(0,e,"self",function(){return this._self},function(t){this._self=t,this._self||(this._cut.visible=!1,this._add.visible=!1)}),a(0,e,"speed",null,function(t){this._fireSpeed=10*t+8}),a(0,e,"bore",null,function(t){this._bore=t,this._battery&&(this._battery.skin=L.batteryUrl.replace(/%d/,this._bore)),this._batteryPip&&(this._batteryPip.skin=L.batteryPipUrl.replace(/%d/,this._bore))}),a(0,e,"score",null,function(t){this._userScore&&(this._userScore.text=t+"")}),a(0,e,"autoLock",function(){return this._autoLock},function(t){this._autoLock=t}),a(0,e,"lockFish",function(){return this._lockFish_ID},function(t){var i=j.Instance.getfisheById(this._lockFish_ID);i&&(i.shotflag.visible=!1),this.setlockLineLengh(0),this._lockFish_ID=t}),a(0,e,"chairdID",function(){return this._chaird_ID},function(t){this._chaird_ID=t}),a(0,e,"playerId",function(){return this._playerID},function(t){this._playerID=t}),a(0,e,"curAngle",function(){return this._fireAngle}),a(0,e,"lockList",null,function(t){this._lock_fish_lst=t}),a(0,e,"key",function(){return"battery"+this._element+"_"+this._bore}),i}(),X=function(t){function i(t){this._life=!0,this._side=3,this._run_time=NaN,this._run_speed=0,this._run_pos=null,this._start_pos=null,this._bonding_box=null,this._b_ID="",this._p_ID="",this._lockFish_ID="",this._bore=0,this._element=0,this._net=null,this._ani=null,i.__super.call(this),this._run_time=14,this._side=3,this._b_ID=t.bulletId,this._p_ID=t.playerId,this._run_pos={x:0,y:0},this._bonding_box=[{a:0,b:0,r:16}],this._bore=t.bore,this._element=t.element,this._lockFish_ID=t.lockfish,this.x=t.spos.x,this.y=t.spos.y,this._start_pos={x:this.x,y:this.y},this._run_speed=10,this._net=new o,this._net.loadAnimation(L.fishNetUrl),this._net.interval=30,this._net.play(0,!1,this.getNRes()),this.addChild(this._net),this._net.visible=!1,this._net.stop(),this._ani=new o,this._ani.loadAnimation(L.bulletUrl),this._ani.interval=30,this._ani.rotation=90,this._ani.play(0,!0,this.getBRes()),this.addChild(this._ani),this.setRotation(t.angle),3==this._side&&this.rotation>180&&(this._side=1)}s(i,"game.module.fish.vo.Bullet",A);var e=i.prototype;return e.setRotation=function(t){this.rotation=t},e.update=function(){if(this.check()){var t=this.getSide();this.setRotation(this.getAngle(t)),this._side=t,this._run_time=0,this._start_pos.x=this._start_pos.x+this._run_pos.x,this._start_pos.y=this._start_pos.y+this._run_pos.y,this._run_pos.x=0,this._run_pos.y=0}var i=D.Instance.getbattery(this._p_ID);""!=this._p_ID&&""!=this._lockFish_ID&&i&&""!=i.lockFish&&i.lockFish==this._lockFish_ID&&i.curAngle<=180&&this.setRotation(i.curAngle),this._run_time=this._run_time+1;var e=this._run_time*this._run_speed;this._run_pos.x=e*Math.cos(this.rotation/180*Math.PI),this._run_pos.y=e*Math.sin(this.rotation/180*Math.PI),this.x=this._start_pos.x+this._run_pos.x,this.y=this._start_pos.y+this._run_pos.y},e.check=function(){for(var t=this._start_pos.x+this._run_pos.x,i=this._start_pos.y+this._run_pos.y,e=0;e<this._bonding_box.length;e++){var n=this._bonding_box[e];if(n&&(t+=n.a,i+=n.b,t<n.r||L.GAME_WIDTH-t<n.r||i<n.r||L.GAME_HEIGHT-i<n.r))return!0}return!1},e.getAngle=function(t){var i=this.rotation;return 90==i||270==i?360-i:0==i||360==i?180:180==i?0:1==this._side&&2==t?i<90?180-i:360-i+180:1==this._side&&3==t?i>90?180-i+180:360-i:1==this._side&&4==t?i>180?360-(i-180):180-i:3==this._side&&2==t?i>270?360-i+180:180-i:3==this._side&&4==t?i>180?360-(i-180):180-i:3==this._side&&1==t?i>90?180-i+180:360-i:4==this._side&&3==t?360-i:4==this._side&&1==t?360-i:4==this._side&&2==t?i<90?180-i:360-i+180:2==this._side&&3==t?i>180?180-(i-180):180-i+180:2==this._side&&1==t?i>90?180-i+180:360-i:2==this._side&&4==t&&i>180?360-(i-180):180-i},e.getSide=function(){var t={x:this._start_pos.x+this._run_pos.x,y:this._start_pos.y+this._run_pos.y},i=0;return t.x<L.GAME_WIDTH/2&&t.y>L.GAME_HEIGHT/2&&t.x<=L.GAME_HEIGHT-t.y?i=4:t.x<L.GAME_WIDTH/2&&t.y>L.GAME_HEIGHT/2&&t.x>L.GAME_HEIGHT-t.y?i=1:t.x<L.GAME_WIDTH/2&&t.y<L.GAME_HEIGHT/2&&t.x<=t.y?i=4:t.x<L.GAME_WIDTH/2&&t.y<L.GAME_HEIGHT/2&&t.x>t.y?i=3:t.x>L.GAME_WIDTH/2&&t.y>L.GAME_HEIGHT/2&&L.GAME_WIDTH-t.x<=L.GAME_HEIGHT-t.y?i=2:t.x>L.GAME_WIDTH/2&&t.y>L.GAME_HEIGHT/2&&L.GAME_WIDTH-t.x>L.GAME_HEIGHT-t.y?i=1:t.x>L.GAME_WIDTH/2&&t.y<L.GAME_HEIGHT/2&&L.GAME_WIDTH-t.x<=t.y?i=2:t.x>L.GAME_WIDTH/2&&t.y<L.GAME_HEIGHT/2&&L.GAME_WIDTH-t.x>t.y&&(i=3),i},e.getBRes=function(){return"ani"+this._bore},e.getBImage=function(){return"res/fish/bullet/bul1_1.png"},e.getNRes=function(){return"net"+this._bore+"_1"},e.shotSomething=function(){var t=this;this._life=!0,this._side=3,this._run_time=0,this._run_pos={x:0,y:0},this._lockFish_ID="",this._ani.stop(),this._ani.removeSelf(),this._ani=null,this._net.visible=!0,this._net.play(0,!1,this.getNRes()),this._net.on("complete",this,function(){t._net.stop(),t._net.visible=!1,t._net.removeSelf(),t.removeSelf()})},a(0,e,"lockFish",function(){return this._lockFish_ID}),a(0,e,"bulletID",function(){return this._b_ID}),a(0,e,"playerID",function(){return this._p_ID}),a(0,e,"BBX",function(){var t=new k(0,0),i=[];for(var e=0 in this._bonding_box){var n=this._bonding_box[e];if(n){t.x=n.a,t.y=n.b,this.localToGlobal(t),U.instance.sceneRotation&&(t.x=L.GAME_WIDTH-t.x,t.y=L.GAME_HEIGHT-t.y);var s={a:t.x,b:t.y,r:n.r};i.push(s)}}return i}),a(0,e,"life",function(){return this._life},function(t){this._life=t}),i}(),V=function(t){function i(t){this._MUIL=1e3,this._life=!0,this._fishID="",this._fishType=1,this._fishConfig=null,this._bonding_box=null,this._ani=null,this._run_count=0,this._run_time=10,this._curve_lst=[],this._curve_way=1,this._curve_angle=0,this._start_pos={x:0,y:0},this._drawbbx=!1,this._cur_angle=0,this._shot_flag=null,this._fish_score=0,this._fish_score_ani=null,this._fish_score_ani_pos={x:0,y:0},this._fish_pause=!1,this._fish_pause_frame_index=0,i.__super.call(this),this._fishID=t.id,this.x=this._start_pos.x=t.x,this.y=this._start_pos.y=t.y,this._fishType=t.type,this._fishType>=22&&(this._fishType=22),this._cur_angle=t.angle,this.rotation=t.angle,this._curve_angle=t.angle,this._fishConfig=this.clone(L.FISH_CONFIG[this._fishType]),this._bonding_box=this._fishConfig.bonding_box,this.createItems();for(var e=0;e<t.curve.length;e++)this.addCurve(t.curve[e]);this._run_time=t.runTime<10?10:t.runTime}s(i,"game.module.fish.vo.Fish",A);var e=i.prototype;return e.createItems=function(){if(this._ani=new o,this._ani.loadAnimation(this._fishConfig.res),this._ani.interval=this._fishConfig.aani.interval,this._ani.play(0,!0,this._fishConfig.aani.key),this.addChild(this._ani),this._shot_flag=new v(L.BATTERY_CONFIG[1].linea),this._shot_flag.anchorX=.5,this._shot_flag.anchorY=.5,this._shot_flag.x=0,this._shot_flag.y=0,this.addChild(this._shot_flag),this._shot_flag.visible=!1,this._drawbbx){var t=this._bonding_box;for(var i=0 in t){var e=t[i];e&&this.graphics.drawCircle(e.a,e.b,e.r,"#000000","#ff0400",5)}}},e.addCurve=function(t){if(t){var i={time:t.t*this._MUIL,v:t.speed,ftype:t.ftype,fparam:t.fparam,t1:0,t2:0};if(this._curve_lst.length<=0)i.t1=0,i.t2=i.t1+i.time,this._curve_lst.push(i);else{var e=this._curve_lst[this._curve_lst.length-1];i.t1=e.t2,i.t2=i.t1+i.time,this._curve_lst.push(i)}}},e.update=function(){if(1!=this._fish_pause){var t=this.getPostionByTime(this._run_time);this.x=t.x,this.y=t.y,this.getNewAngle(t),this.rotation=this._cur_angle,this._run_time=this._run_time+10}else this._ani.stop()},e.getNewAngle=function(t){var i=0,e=this.getPostionByTime(this._run_time+10);0!=this._curve_angle&&(t.x>=e.x?this._curve_way=-1:this._curve_way=1);var n=e.x-t.x,s=e.y-t.y;Math.abs(n)<=1e-7?(0!=this._curve_angle&&(t.y<e.y?this._curve_way=-1:this._curve_way=1),i=-1==this._curve_way?90:270):i=-1==this._curve_way?360-180*Math.atan(s/n)/Math.PI:180-180*Math.atan(s/n)/Math.PI,this._cur_angle=180-i},e.getPostionByTime=function(t){var i={x:0,y:0};if(this._curve_lst.length<=0)return i;this._run_count++;var e=0,n=0;if(t>=this._curve_lst[this._curve_lst.length-1].t2)this._life=!1;else for(var s=0;s<this._curve_lst.length;s++){var a=this._curve_lst[s];if(t>=a.t1&&t<a.t2){e=t-a.t1,n=a.v*(e/this._MUIL);var o=this.getNewPos(a.ftype,{a:a.fparam.a,b:a.fparam.b,c:a.fparam.c,way:a.fparam.way,r:a.fparam.r,k:a.fparam.k,x:n});o.x<1e-10?this._curve_way=-1:this._curve_way=1,i.x=i.x+o.x,i.y=i.y+o.y;break}e=a.time,n=a.v*(e/this._MUIL);var r=this.getNewPos(a.ftype,{a:a.fparam.a,b:a.fparam.b,c:a.fparam.c,way:a.fparam.way,r:a.fparam.r,k:a.fparam.k,x:n});i.x=i.x+r.x,i.y=i.y+r.y}var h="转向前==========x:"+i.x+" y:"+i.y+" param.x:"+n;return 0!=this._curve_angle&&(i.x=i.x*Math.cos(this._curve_angle/180*Math.PI)+i.y*Math.sin(this._curve_angle/180*Math.PI),i.y=i.y*Math.cos(this._curve_angle/180*Math.PI)-i.x*Math.sin(this._curve_angle/180*Math.PI)),h=h+"转向后==========x:"+i.x+" y:"+i.y,h=h+"转向后==========x:"+i.x+" y:"+i.y,i.x=i.x+this._start_pos.x,i.y=-i.y+this._start_pos.y,h=h+" 转换坐标系: this.x:"+i.x+" this.y:"+(i.y+this._start_pos.y),i},e.updateNumber=function(t){var i=t.x+"",e=t.y+"";return{x:parseInt(i),y:parseInt(e)}},e.getNewPos=function(t,i){var e={x:i.x,y:0};switch(t){case 1:e.y=i.a*Math.pow(i.x,2)+i.b*i.x+i.c;break;case 2:e.y=i.a*Math.pow(i.x,3);break;case 3:e.y=Math.pow(i.a,i.x);break;case 4:e.y=i.a*Math.log(i.x);break;case 5:e.y=i.a*Math.sin(i.b*i.x);break;case 6:e.y=i.a*Math.cos(i.b*i.x);break;case 7:1==i.way?e.y=Math.sqrt(Math.pow(i.r,2)-Math.pow(i.x+i.a,2))-i.b:e.y=-Math.sqrt(Math.pow(i.r,2)-Math.pow(i.x+i.a,2))-i.b;break;case 8:e.y=i.k*i.x;break;default:e.y=0}return e},e.death=function(){var t=this;if(this._shot_flag&&(this._shot_flag.visible=!1,this._shot_flag.removeSelf()),this._ani){this._ani.stop(),this._ani.interval=this._fishConfig.dani.interval;var i=0;this._ani.play(0,!0,this._fishConfig.dani.key),this._ani.on("complete",this,function(){i++,t._fishConfig.dani.loop>i?t._ani.play(0,!1,t._fishConfig.dani.key):(t._ani.visible=!1,t._ani.removeSelf(),t._ani=null)})}this.runScoreAni()},e.runScoreAni=function(){var t=this,i=this.parent,e=new I;e.font="Arial",e.text=this._fish_score+"",e.fontSize=70,e.color="#FFFF00",e.stroke=2,e.strokeColor="#000000",e.x=this.x,e.y=this.y,e.anchorX=.5,e.anchorY=.5,i.addChild(e),U.instance.sceneRotation&&(e.rotation=180);for(var n=[],s=this.get_length(this._fish_score),a=1;a<=5;a++){var r=new o;r.loadAnimation("Ani/aniGold.ani"),r.x=this.x+90*a-45*s,r.y=this.y+164,r.interval=24,r.play(0,!0,"ani1"),i.addChild(r),n.push(r)}this.frameOnce(70,this,function(){e.visible=!1,e.removeSelf(),null!=t._ani&&(t._ani.stop(),t._ani.removeSelf());var i=0;for(var s=0 in n){var a=n[s];a&&(i=50*s+500,T.to(a,{x:t._fish_score_ani_pos.x,y:t._fish_score_ani_pos.y},i))}t.timerOnce(i,this,function(){for(var i=0 in n){var e=n[i];e&&e.removeSelf()}t.removeSelf()})})},e.get_length=function(t){return 5},e.isCatched=function(t){var i=new k(0,0);for(var e=0 in t){var n=t[e];if(n)for(var s=0 in this._bonding_box){var a=this._bonding_box[s];if(a){i.x=a.a,i.y=a.b,this.localToGlobal(i),U.instance.sceneRotation&&(i.x=L.GAME_WIDTH-i.x,i.y=L.GAME_HEIGHT-i.y);var o=Math.floor(Math.sqrt(Math.pow(i.x-n.a,2)+Math.pow(i.y-n.b,2)));if(n.r+a.r>=o)return this.beenShot(),!0}}}return!1},e.beenShot=function(){this.makeRedApe(),this.frameOnce(10,this,function(){this.filters=[]})},e.pauseAni=function(){this._ani.stop(),this._fish_pause_frame_index=this._ani.index},e.resumeAni=function(){this._ani.play(this._fish_pause_frame_index,!0,this._fishConfig.aani.key)},e.makeRedApe=function(){var t=new u([1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0]);this.filters=[t]},e.clone=function(t){var i;if("object"==typeof t)if(null===t)i=null;else if(t instanceof Array){i=[];for(var e=0,n=t.length;e<n;e++)i.push(this.clone(t[e]))}else{i={};for(var s in t)i[s]=this.clone(t[s])}else i=t;return i},a(0,e,"BBX",function(){var t=new k(0,0),i=[];for(var e=0 in this._bonding_box){var n=this._bonding_box[e];if(n){this.rotation;t.x=n.a,t.y=n.b,this.localToGlobal(t),U.instance.sceneRotation&&(t.x=L.GAME_WIDTH-t.x,t.y=L.GAME_HEIGHT-t.y);var s={a:t.x,b:t.y,r:n.r};i.push(s)}}return i}),a(0,e,"fishScoreAniPos",function(){return this._fish_score_ani_pos},function(t){this._fish_score_ani_pos=t}),a(0,e,"fishScore",function(){return this._fish_score},function(t){this._fish_score=t}),a(0,e,"shotflag",function(){return this._shot_flag}),a(0,e,"fishID",function(){return this._fishID}),a(0,e,"fishPause",function(){return this._fish_pause},function(t){1==t&&this.pauseAni(),1==this._fish_pause&&0==t&&this.resumeAni(),this._fish_pause=t}),a(0,e,"fishType",function(){return this._fishType}),a(0,e,"lockPos",function(){var t=new k(this._shot_flag.x,this._shot_flag.y);return this.localToGlobal(t),U.instance.sceneRotation&&(t.x=L.GAME_WIDTH-t.x,t.y=L.GAME_HEIGHT-t.y),{x:t.x,y:t.y}}),i}(),Y=(function(t){function i(){i.__super.call(this),E.reg("GAME_FISH","SETUP",K),w.reg("GAME_FISH","FISHHOME",Y);var t=L.INIT_SKINS;t=t.concat(H.initSounds),this.init(t)}s(i,"game.module.fish.FishModule",t);var e=i.prototype;e.onInit=function(){t.prototype.onInit.call(this),U.instance.once("START",this,this.start),U.instance.init(this.dataSource)},e.start=function(){w.enter("GAME_FISH","FISHHOME"),this.initComplete()},e.enter=function(i){t.prototype.enter.call(this,i),H.init()},e.remove=function(){t.prototype.remove.call(this)},e.destroy=function(t){void 0===t&&(t=!0),laya.display.Sprite.prototype.destroy.call(this,t),U.instance.destroy()}}(l),function(t){function i(){this._layer=null,this.classList=[q,z],this.viewList=[],i.__super.call(this),this._layer=new A,this.addChild(this._layer);var t=new q;this._layer.addChild(t),t.visible=!0,this.viewList.push(t);var e=new z;this._layer.addChild(e),e.visible=!1,this.viewList.push(e),U.instance.on("FISHVIEW",this,this.showScene),U.instance.on("ROOMVIEW",this,this.showDesktop)}s(i,"game.module.fish.scene.FishHome",t);var e=i.prototype;return e.showDesktop=function(t){this.showView(0)},e.showScene=function(t){this.showView(1)},e.showView=function(t){for(var i=0 in this.viewList){var e=this.viewList[i];e&&e.hide()}this.viewList[t]&&this.viewList[t].show()},e.destroy=function(i){void 0===i&&(i=!0),t.prototype.destroy.call(this,i),this.viewList=null,this.classList=null},i}(C)),z=function(t){function i(){this.step=0,i.__super.call(this),console.log("FishView"),j.Instance.init(this.fishPanel),R.Instance.init(this.bulletPanel),D.Instance.init(this.batteryPanel),U.instance.on("ALLFISH",this,this.allFish),U.instance.on("ALLUSER",this,this.allUser),U.instance.on("CURSCENE",this,this.curScene),U.instance.on("NEWUSER",this,this.userEnter),U.instance.on("NEWFISH",this,this.newFish),U.instance.on("NEWBULLET",this,this.newBullet),U.instance.on("NEWBATTERY",this,this.newBattery),U.instance.on("LOCKFISH",this,this.lockFish),U.instance.on("QLOCKFISH",this,this.qLockFish),U.instance.on("FISHDEATH",this,this.fishDeath),U.instance.on("USEPROP",this,this.useProp),U.instance.on("OFFLINE",this,this.offLine),U.instance.on("PROPEND",this,this.propEnd),U.instance.on("SCENEPROP",this,this.sceneProp),U.instance.on("ENTERFINISHED",this,this.enterFinished),this.btnVisible1.on("click",this,this.btnRight1Callback),this.btnVisible2.on("click",this,this.btnRight2Callback),this.gameset.on("click",this,this.setCallback),this.gamehelp.on("click",this,this.helpCallback),this.gameexit.on("click",this,this.exitCallback),this.autoLock.on("click",this,this.lockCallback),this.autoFire.on("click",this,this.fireCallback),this.propIce.on("click",this,this.propIceCallback),this.propfire.on("click",this,this.propFireCallback),this.propflash.on("click",this,this.propflashCallback),this.btnshop.on("click",this,this.btnshopCallback),this.bulletPanel.on("mousedown",this,this.batteryCallback),this.timerLoop(1e3,this,this.timeUpdate,null,!1),this.frameLoop(1,this,this.update,null,!1),e.stage.on("visibilitychange",this,function(){U.instance._gameVisible?(U.instance._gameVisible=!1,j.Instance.clearFishes(),R.Instance.clearBullets(),U.instance.exit()):(U.instance.enter(),U.instance._gameVisible=!0)}),c.window.onunload=function(){}}s(i,"game.module.fish.scene.FishView",d);var n=i.prototype;return n.show=function(){this.visible=!0,this.onLoadingFinished()},n.hide=function(){this.visible=!1,j.Instance.clearFishes(),R.Instance.clearBullets(),D.Instance.destroybattery(y.instance.self.userId)},n.btnRight1Callback=function(t){T.to(this.btnsbg,{scaleY:1},100),this.btnVisible1.visible=!1,this.btnVisible2.visible=!0},n.btnRight2Callback=function(t){T.to(this.btnsbg,{scaleY:0},30),this.btnVisible1.visible=!0,this.btnVisible2.visible=!1},n.onLoadingFinished=function(){this.mengbanbg.on("click",this,function(){}),this.mengbanbg.visible=!0,this.mengban.visible=!0,this.visible=!0},n.btnshopCallback=function(t){b.openShop(!0)},n.propFireCallback=function(t){U.instance.sendProp(O.Instance.WIN),this.propfire.mouseEnabled=!1},n.propIceCallback=function(t){U.instance.sendProp(O.Instance.ICE),this.propIce.mouseEnabled=!1},n.propflashCallback=function(t){U.instance.sendProp(O.Instance.ELE),this.propflash.mouseEnabled=!1},n.setCallback=function(t){E.open("GAME_FISH","SETUP")},n.helpCallback=function(t){},n.lockCallback=function(t){U.instance.autoLock?(U.instance.autoLock=!1,U.instance.sendQAutoLock()):(U.instance.autoLock=!0,U.instance.autoFire&&(U.instance.autoFire=!1,D.Instance.autoFire(U.instance.autoFire))),D.Instance.autoLock(U.instance.autoLock)},n.fireCallback=function(t){U.instance.autoFire?U.instance.autoFire=!1:(U.instance.autoFire=!0,U.instance.autoLock&&(U.instance.autoLock=!1,U.instance.sendQAutoLock(),D.Instance.autoLock(U.instance.autoLock))),D.Instance.autoFire(U.instance.autoFire)},n.exitCallback=function(t){U.instance.roomId=0,U.instance.exit()},n.batteryCallback=function(t){var i=new k(t.stageX,t.stageY);this.localToGlobal(i);var e={x:t.stageX,y:t.stageY};if(U.instance.sceneRotation&&(e.x=L.GAME_WIDTH-e.x,e.y=L.GAME_HEIGHT-e.y),U.instance.autoLock){var n=U.instance.getSelfInfo();if(n){var s=j.Instance.catchFishByPos(e);s&&(D.Instance.lockFish(n.index,s.fishID),U.instance.sendAutoLock(s.fishID))}}else D.Instance.reqbatteryFire(e)},n.update=function(){j.Instance.update()&&(this.fishNum.text=""),D.Instance.update();R.Instance.update();if(this.bulNum&&(this.bulNum.text=""),this.step++,this.step>=6){this.step=0;G.Instance.update();this.coNum&&(this.coNum.text="")}},n.timeUpdate=function(){P.Instance.updateTime(),O.Instance.updateTime()},n.newFish=function(t){t.data.initLoc;var i={id:t.data.id,runTime:t.data.runTime,type:t.data.type,x:t.data.initLoc.xD,y:L.GAME_HEIGHT-t.data.initLoc.yD,angle:t.data.config.angle,curve:t.data.config.curve};j.Instance.createFish(i)},n.newBullet=function(t){D.Instance.batteryFire({angle:t.angle,bulletId:t.bullet.bulletId,playerId:t.bullet.playerId,chairID:t.seatIndex,score:t.leftGold})},n.newBattery=function(t){D.Instance.newBattery(t.bulletType,t.seatIndex)},n.allFish=function(){for(var t=U.instance.enterfishes,i=0;i<t.length;i++){var e=t[i],n={id:e.id,runTime:e.runTime,type:e.type,x:e.initLoc.xD,y:L.GAME_HEIGHT-e.initLoc.yD,angle:e.config.angle,curve:e.config.curve};j.Instance.createFish(n)}},n.allUser=function(){D.Instance.destroyAllBattery();for(var t=-1,i=U.instance.players,e=0;e<i.length;e++){var n=i[e];if(n.isSat){var s=!1;y.instance.self.userId==n.playerId&&(t=n.index,s=!0,this.runTips(n.index)),D.Instance.createBattery({isSat:!0,id:n.playerId,name:n.playerName,score:n.playerGold,chairid:n.index,isSelf:s}),D.Instance.newBattery(n.bulletType,n.index)}}t<=1&&-1!=t&&this.rotationScene(),t>-1&&D.Instance.newRotation(t)},n.rotationScene=function(){this.gamebg.rotation=180,this.fishPanel.rotation=180,this.bulletPanel.rotation=180,this.batteryPanel.rotation=180,U.instance.sceneRotation=!0},n.curScene=function(){var t=U.instance.sceneid,i=L.SCENE_CONFIG[t],e=i.res;e=e.replace(/%d/,i.id),this.gamebg.skin=e,U.instance.sceneRotation&&(this.gamebg.rotation=180)},n.userEnter=function(){for(var t=-1,i=U.instance.players,e=0;e<i.length;e++){var n=i[e];if(n.isSat){var s=!1;y.instance.self.userId==n.playerId&&(s=!0,t=n.index),D.Instance.createBattery({isSat:!0,id:n.playerId,name:n.playerName,score:n.playerGold,chairid:n.index,isSelf:s}),D.Instance.newBattery(n.bulletType,n.index)}}-1!=t&&D.Instance.newRotation(t)},n.lockFish=function(t){D.Instance.lockFish(t.seatIndex,t.fishId)},n.qLockFish=function(t){D.Instance.lockFish(t.seatIndex)},n.fishDeath=function(t){for(var i=0 in t.arr){var e=t.arr[i];e&&j.Instance.removeFish(t.seatIndex,e.id,e.score)}},n.sceneProp=function(t){var i=U.instance.sceneProp;i&&i.isUserItem&&O.Instance.startProp(i.ItemId,i.freezeTime)},n.useProp=function(t){var i=t.item;t.playerId==y.instance.self.userId&&P.Instance.addCooling(i.id,i.cdTime),O.Instance.startProp(i.id,i.effectTime)},n.propEnd=function(t){t.item;O.Instance.endProp(O.Instance.ICE,0)},n.offLine=function(t){var i=U.instance.getUserInfoByChairId(t.index);i&&(D.Instance.destroybattery(i.playerId),y.instance.self.userId==i.playerId&&U.instance.event("ROOMVIEW"))},n.enterFinished=function(){var t=[];t.by01=this.propIce,t.by02=this.propfire,t.by03=this.propflash,P.Instance.init(t);var i=U.instance.Cooling;for(var e=0 in i){var n=i[e];n&&P.Instance.addCooling(n.itemId,n.leftTime)}},n.runTips=function(t){var i=this,n=null;n=0==t||3==t?L.BATTERY_CONFIG[4]:L.BATTERY_CONFIG[3];var s=new o;s.loadAnimation(L.enterTips),s.x=n.pos.x,s.y=n.pos.y-300,s.interval=48,s.play(0,!0,"ani1"),this.mengbanbg.addChild(s);var a=function(){i.mengbanbg.visible=!1,i.mengban.visible=!1,s.stop(),s.removeSelf(),s=null,e.timer.clear(i,a)};e.timer.loop(2500,this,a)},n.destroy=function(t){void 0===t&&(t=!0),console.log("destroy"),j.Instance.destroy(),R.Instance.destroy(),D.Instance.destroy(),laya.ui.View.prototype.destroy.call(this,t)},i}(),q=function(t){function i(){var t=this;i.__super.call(this),this.roomList.array=[],U.instance.on("ROOMLIST",this,function(i){t.roomList.array=[];for(var e=0;e<i.data.length;e++)t.roomList.array.push({icon:{skin:L.getRoomIconUrl(e+1)},num:{skin:L.getRoomNameUrl(e+1)},roomId:i.data[e].roomId,min:{text:"准入: "+i.data[e].moneyRange.min,strokeColor:L.getRoomStrokeColor(e)}});for(var n=0;n<t.roomList.array.length;n++){var s=t.roomList.getCell(n);s&&(s.scaleX=0,s.scaleY=0,T.to(s,{scaleX:1.2,scaleY:1.2,complete:g.create(s,function(t){T.to(t,{scaleX:1,scaleY:1},100)},[s])},200*(n+1)))}}),this.roomList.vScrollBarSkin=null,this.roomList.selectEnable=!1,this.roomList.mouseHandler=g.create(this,this.onRoomList,null,!1),U.instance.getRoomInfo(),M.on("SELF_INFO",this,this.onUpdateSelfInfo),this.onUpdateSelfInfo(),this.back.on("click",this,this.onBack)}s(i,"game.module.fish.scene.RoomView",F);var e=i.prototype;return e.resetIcon=function(){for(var t=0;t<this.roomList.array.length;t++){var i=this.roomList.getCell(t);i&&T.to(i,{scaleX:1,scaleY:1},1)}},e.show=function(){this.visible=!0,this.onUpdateSelfInfo()},e.hide=function(){this.visible=!1},e.onUpdateSelfInfo=function(){this.userHead.skin=y.instance.self.avatar,this.userHead.scaleX=1.3,this.userHead.scaleY=1.3;var t=new A;t.graphics.drawCircle(0,0,38,"#ff0000"),t.pos(40,40),this.userHead.mask=t,this.userName.text=y.instance.self.nickname,this.userScore.text=y.instance.self.gold+""},e.onBack=function(){x.hall()},e.onRoomList=function(t,i){"click"==t.type&&(U.instance.roomId=this.roomList.array[i].roomId,U.instance.enter())},e.destroy=function(t){void 0===t&&(t=!0),laya.ui.View.prototype.destroy.call(this,t)},i}(),K=function(t){function i(){this._status=null,this._data=null,i.__super.call(this),this.musicNum.changeHandler=g.create(this,this.onMusicNums,null,!1),this.effectNum.changeHandler=g.create(this,this.onEffectNum,null,!1),this.btnMusic.on("click",this,this.onMusic),this.btnEffect.on("click",this,this.onEffect)}s(i,"game.module.fish.popup.FishSetting",S);var e=i.prototype;return e.onOpened=function(){this._data=r.data,this._status=JSON.stringify(this._data),this.musicNum.value=this._data.musicVolume,this.effectNum.value=this._data.soundVolume,this.btnMusic.selected=this._data.musicOff,this.btnEffect.selected=this._data.soundOff},e.onMusic=function(){this._data.musicOff=this.btnMusic.selected,this.voice()},e.onEffect=function(){this._data.soundOff=this.btnEffect.selected,this.voice()},e.onMusicNums=function(){this._data.musicVolume=this.musicNum.value,this.voice()},e.onEffectNum=function(){this._data.soundVolume=this.effectNum.value,this.voice()},e.voice=function(){var t=JSON.stringify(this._data);t!=this._status&&(this._status=t,r.update(this._data))},i}();e.__init([P,D,j,R,G,O])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});for(var e in Laya){var n=Laya[e];n&&n.__isclass&&(i[e]=n)}});